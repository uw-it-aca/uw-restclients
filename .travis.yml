sudo: false
language: python
services:
- memcached
python:
- '2.7'
- '2.6'
install:
- if [[ $TRAVIS_TAG ]]; then sed -i "s/TRAVIS_TAG/$TRAVIS_TAG/" setup.py; fi;
- if [[ ! $TRAVIS_TAG ]]; then sed -i "s/TRAVIS_TAG/0.0/" setup.py; fi;
- if [[ $TRAVIS_PYTHON_VERSION == 2.6* ]]; then pip install -r travis-ci/python-2.6-require-django-1.6.txt;
  fi
- pip install -r restclients/requirements.txt
before_script:
- pip install coverage
- pip install python-coveralls
- pip install pep8
- cp travis-ci/manage.py manage.py
- python manage.py syncdb --noinput
script:
- pep8 --exclude=migrations,restclients/sws/,restclients/canvas/,restclients/uwnetid/,restclients/test/,restclients/signals/,restclients/hfs/,restclients/r25,restclients/nws.py,restclients/sms.py,restclients/library/
  restclients/
- python -m compileall restclients/
- coverage run --source=restclients manage.py test restclients
after_script:
- coveralls
notifications:
  webhooks:
    urls:
    - https://yarn.cac.washington.edu/rest/botalyst/v1/travis-ci
deploy:
  provider: pypi
  user: uw-it-aca
  on:
    all_branches: true
    tags: true
  password:
    secure: r73n4HjZXrvZODPl52ESwnol33KUNEOQnIQ2ikmiT522mKPomJBUpdwicaJdguqvQ9KBOSS3ycrgsavZOBvrK7JAtKf+ChCokqcJKIfJ5detKZrVaImpYXV8qZ9JxGoKADv/Q35Qwzwc8UYeuxZlwuptF8tyKGDgPcHPWSwd4hM=
